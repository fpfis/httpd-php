set daemon 10

set log /var/log/monit.log

set httpd port 2812 and
    allow localhost        # allow localhost to connect to the server and
    allow admin:monit      # require user 'admin' with password 'monit'

check process apache with pidfile /run/httpd.pid
  start program = "/usr/sbin/httpd" with timeout 10 seconds
  stop program  = "/usr/sbin/httpd -k stop"
  if 2 restarts within 3 cycles then unmonitor

check process php-fpm with pidfile /run/php-fpm.pid
  depends on apache
  start program = "/usr/local/sbin/php-fpm -g /run/php-fpm.pid -D" with timeout 60 seconds
  stop program  = "/bin/kill `/bin/cat /run/php-fpm.pid`"
